<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 9 Quiz - EDUCATION DEPARTMENT SCREENING TEST PREPARATION – June 27, 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F9FA; /* Very light gray */
            color: #2C3E50; /* Main text color */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Full viewport height */
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }

        /* Top Bar Styling */
        .top-bar {
            background-color: #ffffff;
            border-bottom: 1px solid #e0e0e0;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .top-bar .date-display {
            color: #6D6875;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .top-bar .whatsapp-link {
            color: #6D6875;
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Header Section Styling */
        .header-section {
            background-color: #ffffff;
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 1rem;
        }

        .quiz-title {
            font-family: 'Roboto', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 1rem;
        }

        .progress-bar-container {
            width: 80%;
            max-width: 600px;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 1rem auto;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #20B2AA, #3EB489); /* Teal to Mint Green */
            border-radius: 5px;
            transition: width 0.3s ease-in-out;
        }

        .banner-logo {
            max-width: 200px;
            height: auto;
            border-radius: 8px;
            margin-top: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .credits {
            font-size: 0.85rem;
            color: #6D6875;
            margin-top: 0.5rem;
        }

        /* Card Styling (for login, quiz, results pages) */
        .card {
            background-color: #FFF5EE; /* PeachPuff - very light, warm tone */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin: 1rem auto;
            max-width: 700px;
            width: 90%;
            box-sizing: border-box;
        }

        /* Button Styling */
        .button-gradient {
            background-image: linear-gradient(to right, #E6E6FA, #FFDAB9); /* Lavender to PeachPuff - light and attractive */
            color: #2C3E50; /* Dark text for contrast */
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            border: none;
        }

        .button-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .button-gradient:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .option-button {
            background-color: #ffffff;
            border: 1px solid #ddd; /* Light border */
            padding: 0.75rem 1rem;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.75rem;
            color: #2C3E50;
            font-weight: normal;
        }

        .option-button:hover:not(.selected) {
            background-color: #f0f0f0; /* Slightly darker on hover */
        }

        .option-button.selected {
            border-color: #6D6875; /* Medium gray for selected */
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .option-button.correct {
            background-color: #90EE90; /* LightGreen */
            border-color: #28a745; /* Darker green border */
            animation: pulse-green 0.5s ease-out forwards;
        }

        .option-button.incorrect {
            background-color: #FF6B6B; /* Light Red */
            border-color: #dc3545; /* Darker red border */
            animation: shake-red 0.5s ease-out forwards;
        }

        /* Special Question Styling */
        .special-question {
            border: 3px solid #FFD700; /* Gold border */
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); /* Glowing effect */
        }

        /* Explanation Section Styling */
        .explanation {
            background-color: #e0f7fa; /* Light Cyan */
            border-left: 5px solid #20B2AA; /* Teal border */
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 8px;
            color: #2C3E50;
            font-size: 0.9rem;
            display: none; /* Hidden by default */
        }

        /* Timer and Progress Display */
        .timer-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2C3E50;
            margin-bottom: 1rem;
            text-align: center;
        }

        .question-progress {
            font-size: 1rem;
            color: #6D6875;
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Animations */
        @keyframes pulse-green {
            0% { transform: scale(1); }
            50% { transform: scale(1.01); }
            100% { transform: scale(1); }
        }

        @keyframes shake-red {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .top-bar {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.5rem;
            }
            .top-bar .date-display {
                order: 2; /* Move date to bottom on mobile */
                font-size: 0.8rem;
            }
            .top-bar .whatsapp-link {
                order: 1; /* Move whatsapp to top on mobile */
                font-size: 0.8rem;
            }
            .quiz-title {
                font-size: 1.5rem;
            }
            .banner-logo {
                max-width: 150px;
            }
            .card {
                margin: 0.75rem auto;
                padding: 1rem;
            }
            .button-gradient {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
            .option-button {
                padding: 0.6rem 0.8rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <script>
        // Disable right-click, specific keyboard shortcuts (Ctrl+U, Ctrl+Shift+I, Ctrl+Shift+J, F12), copy, and paste
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && (e.key === 'u' || e.key === 'U' || e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j')) {
                e.preventDefault();
            }
            if (e.key === 'F12') {
                e.preventDefault();
            }
        });
        document.addEventListener('copy', event => event.preventDefault());
        document.addEventListener('paste', event => event.preventDefault());
    </script>

    <div class="top-bar">
        <a href="https://chat.whatsapp.com/H3uhXoDodPmAOaVvi3PcZq" target="_blank" class="whatsapp-link">
            <i class="fab fa-whatsapp"></i> Join WhatsApp Community
        </a>
        <div class="date-display" id="liveDate"></div>
    </div>

    <div class="header-section">
        <h1 class="quiz-title" id="quizTitle"></h1>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <img src="https://i.ibb.co/LXdkJVy8/20250524-0050-Empowering-Educators-remix-01jw0makvqewdvqns1te3jvpgs.png" alt="Banner Logo" class="banner-logo mx-auto">
        <div class="credits">
            KP Teacher Corps | PREPARED BY: SYED ASGHAR ALI SHAH | Contact: 03265762698
            <br>
            Updated on: <span id="updatedDate"></span>
        </div>
    </div>

    <main class="flex-grow flex items-center justify-center p-4">
        <!-- All page sections are initially hidden to prevent flicker -->
        <div id="loginPage" class="card hidden">
            <h2 class="text-xl font-bold mb-4 text-center">Login</h2>
            <div class="mb-4">
                <label for="loginId" class="block text-sm font-medium text-gray-700 mb-1">ID:</label>
                <input type="text" id="loginId" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" value="">
            </div>
            <div class="mb-6">
                <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Password:</label>
                <input type="password" id="loginPassword" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" value="">
            </div>
            <p id="loginError" class="text-red-500 text-sm mb-4 hidden">Invalid ID or Password</p>
            <button id="loginBtn" class="button-gradient w-full">Login</button>
        </div>

        <div id="candidateNamePage" class="card hidden">
            <h2 class="text-xl font-bold mb-4 text-center">Candidate Information</h2>
            <div class="mb-6">
                <label for="candidateName" class="block text-sm font-medium text-gray-700 mb-1">Enter Full Name:</label>
                <input type="text" id="candidateName" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Your Full Name">
            </div>
            <p id="nameError" class="text-red-500 text-sm mb-4 hidden">Please enter your full name.</p>
            <button id="startQuizBtn" class="button-gradient w-full">Start Quiz</button>
        </div>

        <div id="quizPage" class="card hidden">
            <div class="timer-display" id="timerDisplay"></div>
            <div class="question-progress" id="questionProgress"></div>
            <h2 class="text-lg font-semibold mb-4" id="questionText"></h2>
            <div id="optionsContainer" class="flex flex-col gap-3 mb-6">
            </div>
            <div class="flex justify-between">
                <button id="prevBtn" class="button-gradient px-6 py-2">Previous</button>
                <button id="nextBtn" class="button-gradient px-6 py-2">Next</button>
                <button id="submitQuizBtn" class="button-gradient px-6 py-2 hidden">Submit Quiz</button>
            </div>
            <div id="explanationDiv" class="explanation"></div>
        </div>

        <div id="resultsPage" class="card hidden">
            <h2 class="text-xl font-bold mb-4 text-center">Quiz Results</h2>
            <p class="mb-2"><strong>Candidate Name:</strong> <span id="resultCandidateName"></span></p>
            <p class="mb-2"><strong>Date of Quiz:</strong> <span id="resultDate"></span></p>
            <p class="mb-2"><strong>Score:</strong> <span id="resultScore"></span> / <span id="maxScore"></span></p>
            <p class="mb-2"><strong>Correct Answers:</strong> <span id="resultCorrect"></span></p>
            <p class="mb-2"><strong>Incorrect Answers:</strong> <span id="resultIncorrect"></span></p>
            <p class="mb-4"><strong>Time Taken:</strong> <span id="resultTimeTaken"></span></p>
            <button id="restartQuizBtn" class="button-gradient w-full">Restart Quiz</button>
        </div>
    </main>

    <script>
        // Set the current date for display and logic
        const CURRENT_DATE_STR = "June 27, 2025";
        const CURRENT_DATE = new Date(CURRENT_DATE_STR);

        // Update header dates
        document.getElementById('liveDate').textContent = CURRENT_DATE_STR;
        document.getElementById('updatedDate').textContent = CURRENT_DATE_STR;
        document.getElementById('quizTitle').textContent = `Day 9 Quiz - EDUCATION DEPARTMENT SCREENING TEST PREPARATION – ${CURRENT_DATE_STR}`;

        // Quiz Data Structure
        const originalQuizQuestions = []; // Stores the initial, unshuffled questions
        let quizQuestions = []; // This array will be shuffled and used for the current quiz
        let currentQuestionIndex = 0;
        // Stores { questionIndex: int (original index), selectedOptionIndex: int (index in shuffled options), isCorrect: bool, originalCorrectOptionIndex: int }
        let userAnswers = []; 
        let quizStartTime;
        let timerInterval;
        const QUIZ_DURATION_MINUTES = 40; // Default quiz duration
        let specialQuestionOriginalIndex = -1; // To store the original index of the special question

        // --- Helper Functions ---

        /**
         * Shuffles an array in place using Fisher-Yates (Knuth) shuffle.
         * @param {Array} array - The array to shuffle.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * Converts seconds to a human-readable time string (e.g., "35 minutes 10 seconds").
         * @param {number} totalSeconds - The total number of seconds.
         * @returns {string} Formatted time string.
         */
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes} minutes ${seconds} seconds`;
        }

        /**
         * Updates the progress bar and question progress text.
         */
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / quizQuestions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('questionProgress').textContent = `Question ${currentQuestionIndex + 1}/${quizQuestions.length} – ${Math.round(progress)}% Complete`;
        }

        /**
         * Displays a specific page and hides others.
         * @param {string} pageId - The ID of the page to display.
         */
        function showPage(pageId) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('candidateNamePage').classList.add('hidden');
            document.getElementById('quizPage').classList.add('hidden');
            document.getElementById('resultsPage').classList.add('hidden');
            document.getElementById(pageId).classList.remove('hidden');
        }

        /**
         * Starts the quiz timer.
         */
        function startTimer() {
            quizStartTime = Date.now();
            let timeLeft = QUIZ_DURATION_MINUTES * 60; // Convert minutes to seconds

            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('timerDisplay').textContent = `Time Left: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz(true); // Auto-submit on timer expiry
                } else {
                    timeLeft--;
                }
            }

            updateTimerDisplay(); // Initial display
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        /**
         * Renders the current question and its options.
         */
        function renderQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            document.getElementById('questionText').innerHTML = question.question;
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = ''; // Clear previous options

            // Remove special-question class from previous question if any
            const quizCard = document.getElementById('quizPage');
            quizCard.classList.remove('special-question');

            // Add special-question class if it's today's special question and date matches
            const today = new Date().toDateString();
            if (question.special && CURRENT_DATE.toDateString() === today) {
                quizCard.classList.add('special-question');
            }
            
            // Create a shuffled copy of the options for the current question
            // We need to store the original index mapping before shuffling
            const shuffledOptionsWithOriginalIndex = question.options.map((option, index) => ({
                optionText: option,
                originalIndex: index
            }));
            shuffleArray(shuffledOptionsWithOriginalIndex);

            // Store the shuffled options and their original correct index for this question
            // This allows us to track the correct option even after shuffling
            quizQuestions[currentQuestionIndex].shuffledOptions = shuffledOptionsWithOriginalIndex;
            quizQuestions[currentQuestionIndex].shuffledCorrectOptionIndex = shuffledOptionsWithOriginalIndex.findIndex(
                opt => opt.originalIndex === question.correctOptionIndex
            );

            shuffledOptionsWithOriginalIndex.forEach((optionObj, index) => {
                const button = document.createElement('button');
                button.classList.add('option-button', 'w-full');
                button.innerHTML = optionObj.optionText; // Use innerHTML to render LaTeX
                button.dataset.shuffledOptionIndex = index; // Store the shuffled index
                button.onclick = () => selectOption(index);

                // Apply selected state if already answered
                const userAnswer = userAnswers[currentQuestionIndex];
                if (userAnswer && userAnswer.selectedOptionIndex === index) {
                    button.classList.add('selected');
                    if (userAnswer.isCorrect) {
                        button.classList.add('correct');
                    } else {
                        button.classList.add('incorrect');
                    }
                    // Disable all options if already answered
                    Array.from(optionsContainer.children).forEach(optBtn => optBtn.disabled = true);
                    document.getElementById('explanationDiv').style.display = 'block';
                }
                optionsContainer.appendChild(button);
            });

            // Render math equations using MathJax if available
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([document.getElementById('questionText'), optionsContainer]);
            }


            // Show/hide explanation
            const explanationDiv = document.getElementById('explanationDiv');
            explanationDiv.innerHTML = `<p class="font-bold">Explanation:</p><p>${question.explanation}</p>`;
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([explanationDiv]);
            }
            if (userAnswers[currentQuestionIndex] && userAnswers[currentQuestionIndex].selectedOptionIndex !== undefined) {
                explanationDiv.style.display = 'block';
            } else {
                explanationDiv.style.display = 'none';
            }

            // Update navigation buttons visibility
            document.getElementById('prevBtn').classList.toggle('hidden', currentQuestionIndex === 0);
            document.getElementById('nextBtn').classList.toggle('hidden', currentQuestionIndex === quizQuestions.length - 1);
            document.getElementById('submitQuizBtn').classList.toggle('hidden', currentQuestionIndex !== quizQuestions.length - 1);

            updateProgressBar();
        }

        /**
         * Handles option selection by the user.
         * @param {number} selectedOptionIndex - The index of the selected option from the SHUFFLED options.
         */
        function selectOption(selectedOptionIndex) {
            const question = quizQuestions[currentQuestionIndex];
            const isCorrect = (selectedOptionIndex === question.shuffledCorrectOptionIndex);

            // Store user's answer
            userAnswers[currentQuestionIndex] = {
                questionIndex: currentQuestionIndex,
                selectedOptionIndex: selectedOptionIndex, // This is the index in the SHUFFLED options
                isCorrect: isCorrect,
                originalCorrectOptionIndex: question.correctOptionIndex // Store original correct index for reference if needed
            };

            // Apply visual feedback
            const optionsContainer = document.getElementById('optionsContainer');
            Array.from(optionsContainer.children).forEach((button, index) => {
                button.disabled = true; // Disable all options after selection
                button.classList.remove('selected', 'correct', 'incorrect'); // Clear previous states

                if (index === selectedOptionIndex) {
                    button.classList.add('selected');
                    if (isCorrect) {
                        button.classList.add('correct');
                    } else {
                        button.classList.add('incorrect');
                    }
                } else if (index === question.shuffledCorrectOptionIndex) {
                    // Highlight the correct answer even if not selected by the user
                    button.classList.add('correct');
                }
            });

            // Show explanation
            document.getElementById('explanationDiv').style.display = 'block';
             // Render math equations in explanation
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([document.getElementById('explanationDiv')]);
            }
        }

        /**
         * Navigates to the next question.
         */
        function nextQuestion() {
            if (currentQuestionIndex < quizQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        }

        /**
         * Navigates to the previous question.
         */
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        /**
         * Submits the quiz, calculates results, and displays them.
         * @param {boolean} isAutoSubmit - True if submitted by timer, false otherwise.
         */
        function submitQuiz(isAutoSubmit = false) {
            clearInterval(timerInterval); // Stop the timer

            const endTime = Date.now();
            const timeTakenSeconds = Math.round((endTime - quizStartTime) / 1000);

            let correctCount = 0;
            let incorrectCount = 0;
            let totalAttempted = 0;

            userAnswers.forEach(answer => {
                if (answer && answer.selectedOptionIndex !== undefined) {
                    totalAttempted++;
                    if (answer.isCorrect) {
                        correctCount++;
                    } else {
                        incorrectCount++;
                    }
                }
            });

            const maxPossibleScore = quizQuestions.length * 2; // 2 points per question
            const score = (correctCount * 2) - incorrectCount; // Score calculation: 2 for correct, -1 for incorrect

            const candidateName = document.getElementById('candidateName').value;

            document.getElementById('resultCandidateName').textContent = candidateName;
            document.getElementById('resultDate').textContent = CURRENT_DATE_STR;
            document.getElementById('resultScore').textContent = score;
            document.getElementById('maxScore').textContent = maxPossibleScore;
            document.getElementById('resultCorrect').textContent = `${correctCount} / ${totalAttempted}`;
            document.getElementById('resultIncorrect').textContent = `${incorrectCount} / ${totalAttempted}`;
            document.getElementById('resultTimeTaken').textContent = formatTime(timeTakenSeconds);

            showPage('resultsPage');

            // Silent Formspree submission
            const formData = new FormData();
            formData.append('Candidate Name', candidateName);
            formData.append('Date of Quiz', CURRENT_DATE_STR);
            formData.append('Score', score);
            formData.append('Correct Answers', correctCount);
            formData.append('Incorrect Answers', incorrectCount);
            formData.append('Time Taken', formatTime(timeTakenSeconds));
            formData.append('Quiz ID', "day9"); // Specific ID for Day 9 quiz

            fetch('https://formspree.io/f/xwpojgab', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            }).then(response => {
                if (response.ok) {
                    console.log('Quiz results submitted successfully!');
                } else {
                    console.error('Formspree submission failed.');
                }
            }).catch(error => {
                console.error('Error during Formspree submission:', error);
            });
        }

        // --- Event Listeners ---

        document.getElementById('loginBtn').addEventListener('click', () => {
            const id = document.getElementById('loginId').value;
            const password = document.getElementById('loginPassword').value;
            const loginError = document.getElementById('loginError');

            // Specific credentials for Day 9
            if (id === 'day9' && password === '9999') {
                loginError.classList.add('hidden');
                showPage('candidateNamePage');
            } else {
                loginError.classList.remove('hidden');
            }
        });

        document.getElementById('startQuizBtn').addEventListener('click', () => {
            const candidateNameInput = document.getElementById('candidateName');
            const candidateName = candidateNameInput.value.trim();
            const nameError = document.getElementById('nameError');

            if (candidateName) {
                nameError.classList.add('hidden');
                // Initialize userAnswers array for the new quiz attempt
                userAnswers = new Array(quizQuestions.length).fill(null);
                currentQuestionIndex = 0;
                startTimer();
                renderQuestion();
                showPage('quizPage');
            } else {
                nameError.classList.remove('hidden');
            }
        });

        document.getElementById('nextBtn').addEventListener('click', nextQuestion);
        document.getElementById('prevBtn').addEventListener('click', prevQuestion);
        document.getElementById('submitQuizBtn').addEventListener('click', () => submitQuiz(false));
        document.getElementById('restartQuizBtn').addEventListener('click', () => {
            // Reset quiz state
            currentQuestionIndex = 0;
            userAnswers = [];
            clearInterval(timerInterval); // Clear any lingering timer
            // Re-initialize and re-shuffle questions for a new attempt
            initializeQuiz(); 
            // Clear login fields and go back to login page
            document.getElementById('loginId').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('candidateName').value = '';
            showPage('loginPage');
        });

        // --- Quiz Initialization ---
        function initializeQuiz() {
            // Populate originalQuizQuestions (only once) if not already populated
            if (originalQuizQuestions.length === 0) {
                // Pedagogy (10 MCQs from Pages 33-36)
                const pedagogyMCQs = [
                    { question: "What is 'cognitivism' in educational psychology?", options: ["A theory that focuses on external behaviors.", "A theory that emphasizes mental processes like thinking, memory, perception, and problem-solving.", "A theory about social interaction.", "A theory that focuses on emotional development."], correctOptionIndex: 1, explanation: "Cognitivism focuses on how individuals acquire, process, and store information (Page 33)." },
                    { question: "Who are some prominent figures associated with cognitivism?", options: ["Pavlov and Skinner", "Freud and Erikson", "Piaget and Vygotsky", "Watson and Thorndike"], correctOptionIndex: 2, explanation: "Piaget's cognitive development theory and Vygotsky's sociocultural theory are key to cognitivism (Page 33)." },
                    { question: "What is a 'cognitive map'?", options: ["A map of a geographical area.", "A mental representation of one's physical environment or spatial relationships.", "A diagram of the brain.", "A tool for memory recall."], correctOptionIndex: 1, explanation: "Cognitive maps help individuals navigate and understand their surroundings (Page 33)." },
                    { question: "What is 'problem-solving' in cognitive psychology?", options: ["The ability to recall facts quickly.", "The process of identifying a problem, generating solutions, and evaluating their effectiveness.", "The ability to memorize long lists.", "The process of emotional regulation."], correctOptionIndex: 1, explanation: "Problem-solving involves various cognitive strategies (Page 34)." },
                    { question: "What is 'critical thinking'?", options: ["Accepting information without questioning.", "The objective analysis and evaluation of information in order to form a judgment.", "Memorizing facts for a test.", "Believing everything you hear."], correctOptionIndex: 1, explanation: "Critical thinking is essential for informed decision-making and problem-solving (Page 34)." },
                    { question: "Which cognitive process involves organizing information into categories or groups?", options: ["Retrieval", "Encoding", "Storage", "Categorization"], correctOptionIndex: 3, explanation: "Categorization helps simplify and manage complex information (Page 34)." },
                    { question: "What is 'metacognition'?", options: ["Thinking about emotions.", "Thinking about thinking, or awareness and understanding of one's own thought processes.", "The study of brain functions.", "The ability to multitask."], correctOptionIndex: 1, explanation: "Metacognition includes self-regulation, self-reflection, and self-assessment (Page 35)." },
                    { question: "Which of the following is a metacognitive strategy?", options: ["Memorizing a poem.", "Planning how to approach a learning task.", "Copying notes from a textbook.", "Listening to a lecture passively."], correctOptionIndex: 1, explanation: "Planning, monitoring, and evaluating one's learning are metacognitive skills (Page 35)." },
                    { question: "What is 'transfer of learning'?", options: ["Forgetting what was learned.", "Applying knowledge and skills learned in one context to another context.", "Learning new information.", "Revising old lessons."], correctOptionIndex: 1, explanation: "Transfer of learning can be positive, negative, or zero (Page 36)." },
                    { question: "When does 'positive transfer' of learning occur?", options: ["When prior learning hinders new learning.", "When prior learning helps new learning.", "When prior learning has no effect on new learning.", "When only new information is acquired."], correctOptionIndex: 1, explanation: "Positive transfer makes it easier to learn new tasks (Page 36)." }
                ];
                originalQuizQuestions.push(...pedagogyMCQs);

                // General Science (25 MCQs from Pages 225-270)
                const generalScienceMCQs = [
                    { question: "Which of the following is an example of a 'chemical change'?", options: ["Melting ice", "Boiling water", "Burning wood", "Dissolving sugar"], correctOptionIndex: 2, explanation: "Burning wood creates new substances like ash and smoke (Page 225)." },
                    { question: "What is a 'mixture'?", options: ["A substance made of one type of atom.", "A substance formed when two or more elements are chemically bonded.", "A substance containing two or more different substances that are not chemically bonded together.", "A pure compound."], correctOptionIndex: 2, explanation: "Mixtures can be homogeneous (uniform) or heterogeneous (non-uniform) (Page 226)." },
                    { question: "What is a 'solution'?", options: ["A heterogeneous mixture.", "A homogeneous mixture in which one substance (the solute) is dissolved in another (the solvent).", "A suspension.", "A colloid."], correctOptionIndex: 1, explanation: "Solutions include examples like salt water or air (Page 227)." },
                    { question: "Which method is used to separate a solid from a liquid in a suspension?", options: ["Distillation", "Evaporation", "Filtration", "Chromatography"], correctOptionIndex: 2, explanation: "Filtration separates insoluble solids from liquids (Page 228)." },
                    { question: "What is 'evaporation'?", options: ["The process of a liquid turning into a solid.", "The process of a gas turning into a liquid.", "The process of a liquid turning into a gas.", "The process of a solid turning into a gas."], correctOptionIndex: 2, explanation: "Evaporation is a common method for separating a soluble solid from a liquid in a solution (Page 229)." },
                    { question: "What is 'condensation'?", options: ["The process of a liquid turning into a gas.", "The process of a gas turning into a liquid.", "The process of a solid turning into a liquid.", "The process of a liquid turning into a solid."], correctOptionIndex: 1, explanation: "Condensation is the reverse of evaporation and is important in the water cycle (Page 230)." },
                    { question: "What is the 'pH scale' used to measure?", options: ["Temperature", "Acidity or alkalinity", "Density", "Volume"], correctOptionIndex: 1, explanation: "The pH scale ranges from 0 to 14, with 7 being neutral (Page 231)." },
                    { question: "A substance with a pH of 7 is considered:", options: ["Acidic", "Basic", "Neutral", "Alkaline"], correctOptionIndex: 2, explanation: "Pure water has a pH of 7 (Page 231)." },
                    { question: "A substance with a pH less than 7 is considered:", options: ["Basic", "Neutral", "Acidic", "Alkaline"], correctOptionIndex: 2, explanation: "Acids like lemon juice have low pH values (Page 232)." },
                    { question: "A substance with a pH greater than 7 is considered:", options: ["Acidic", "Neutral", "Basic", "Alkaline"], correctOptionIndex: 2, explanation: "Bases like baking soda solution have high pH values (Page 232)." },
                    { question: "What is a 'salt' formed from?", options: ["An acid and a metal.", "A base and a non-metal.", "The reaction between an acid and a base (neutralization reaction).", "Two metals reacting."], correctOptionIndex: 2, explanation: "Salts are ionic compounds formed from the cation of a base and the anion of an acid (Page 233)." },
                    { question: "What is the formula for 'water'?", options: ["CO2", "O2", "H2O", "CH4"], correctOptionIndex: 2, explanation: "Water is a vital compound for all known forms of life (Page 234)." },
                    { question: "Which gas do plants absorb from the atmosphere for photosynthesis?", options: ["Oxygen", "Nitrogen", "Carbon dioxide", "Hydrogen"], correctOptionIndex: 2, explanation: "Carbon dioxide is a key reactant in photosynthesis (Page 235)." },
                    { question: "Which gas do animals inhale for respiration?", options: ["Carbon dioxide", "Nitrogen", "Oxygen", "Methane"], correctOptionIndex: 2, explanation: "Oxygen is essential for cellular respiration to release energy (Page 236)." },
                    { question: "What is 'combustion'?", options: ["A process of cooling.", "A chemical process that involves the rapid reaction between a substance with an oxidant, usually oxygen, to produce heat and light.", "A process of dissolving.", "A process of melting."], correctOptionIndex: 1, explanation: "Combustion is commonly known as burning (Page 237)." },
                    { question: "Which of the following is a fossil fuel?", options: ["Solar energy", "Wind energy", "Coal", "Geothermal energy"], correctOptionIndex: 2, explanation: "Fossil fuels are formed from the remains of ancient organisms (Page 238)." },
                    { question: "What is 'renewable energy'?", options: ["Energy that runs out quickly.", "Energy that is generated from natural processes that are continuously replenished.", "Energy produced from fossil fuels.", "Energy that causes pollution."], correctOptionIndex: 1, explanation: "Renewable energy sources include solar, wind, hydro, and geothermal (Page 239)." },
                    { question: "Which of the following is a non-renewable energy source?", options: ["Hydroelectric power", "Nuclear energy", "Biomass energy", "Tidal energy"], correctOptionIndex: 1, explanation: "Nuclear energy uses uranium, a finite resource (Page 240)." },
                    { question: "What is the process by which water continuously moves from the Earth's surface to the atmosphere and back?", options: ["Carbon cycle", "Nitrogen cycle", "Water cycle", "Oxygen cycle"], correctOptionIndex: 2, explanation: "The water cycle involves evaporation, condensation, precipitation, and collection (Page 241)." },
                    { question: "What is 'precipitation' in the water cycle?", options: ["Water turning into vapor.", "Water droplets forming clouds.", "Water falling from the atmosphere to the Earth's surface in forms like rain, snow, or hail.", "Water flowing into rivers."], correctOptionIndex: 2, explanation: "Precipitation is how water returns to the Earth's surface (Page 242)." },
                    { question: "What is 'pollution'?", options: ["Natural environmental changes.", "The introduction of harmful substances or products into the environment.", "Recycling waste.", "Protecting wildlife."], correctOptionIndex: 1, explanation: "Pollution can affect air, water, and land (Page 243)." },
                    { question: "What is 'air pollution'?", options: ["Contamination of water bodies.", "The presence of substances in the atmosphere that are harmful to humans and other living beings, or to the climate or to materials.", "Contamination of soil.", "Noise disturbance."], correctOptionIndex: 1, explanation: "Common air pollutants include particulate matter, ozone, and sulfur dioxide (Page 244)." },
                    { question: "What is 'water pollution'?", options: ["Contamination of air.", "The contamination of water bodies, usually as a result of human activities, in such a manner that it negatively affects its legitimate uses.", "Soil erosion.", "Overpopulation."], correctOptionIndex: 1, explanation: "Water pollution can be caused by industrial waste, sewage, and agricultural runoff (Page 245)." },
                    { question: "What is 'soil pollution'?", options: ["Contamination of air.", "The buildup of persistent toxic compounds, chemicals, salts, radioactive materials, or disease-causing agents in soil to the extent that it harms plant and animal life.", "Noise pollution.", "Light pollution."], correctOptionIndex: 1, explanation: "Soil pollution reduces soil fertility and can enter the food chain (Page 246)." },
                    { question: "What is the 'greenhouse effect'?", options: ["A cooling effect on Earth.", "A natural process that warms the Earth's surface and atmosphere, caused by certain gases trapping heat.", "A process that creates ozone.", "A phenomenon that causes ice ages."], correctOptionIndex: 1, explanation: "The greenhouse effect is essential for maintaining Earth's temperature, but excessive greenhouse gases lead to global warming (Page 247)." }
                ];
                originalQuizQuestions.push(...generalScienceMCQs);

                // Social Studies (15 MCQs from Pages 579-590 - Geography: Natural Resources)
                const socialStudiesMCQs = [
                    { question: "What are 'natural resources'?", options: ["Man-made products.", "Materials or substances occurring in nature which can be used for economic gain.", "Things found in space.", "Artificial intelligence."], correctOptionIndex: 1, explanation: "Natural resources include air, water, soil, minerals, forests, and wildlife (Page 579)." },
                    { question: "Which of the following is a 'renewable resource'?", options: ["Coal", "Natural gas", "Solar energy", "Petroleum"], correctOptionIndex: 2, explanation: "Renewable resources replenish naturally over a relatively short period (Page 580)." },
                    { question: "Which of the following is a 'non-renewable resource'?", options: ["Wind energy", "Geothermal energy", "Iron ore", "Biomass"], correctOptionIndex: 2, explanation: "Non-renewable resources exist in finite quantities and are consumed much faster than they are formed (Page 581)." },
                    { question: "What is 'deforestation'?", options: ["Planting new trees.", "The clearing of forests by logging or burning, typically for agricultural or other land uses.", "Forest conservation.", "Sustainable forestry."], correctOptionIndex: 1, explanation: "Deforestation leads to habitat loss, soil erosion, and climate change (Page 582)." },
                    { question: "What is 'conservation' of natural resources?", options: ["Using resources without limit.", "The careful preservation and protection of something, especially planned management of a natural resource to prevent exploitation, destruction, or neglect.", "Wasting resources.", "Ignoring environmental impacts."], correctOptionIndex: 1, explanation: "Conservation aims to ensure the long-term availability of resources (Page 583)." },
                    { question: "What is 'water scarcity'?", options: ["Abundance of water.", "Lack of sufficient available water resources to meet the demands of water usage within a region.", "Clean drinking water.", "Excessive rainfall."], correctOptionIndex: 1, explanation: "Water scarcity is a global issue affecting many populations (Page 584)." },
                    { question: "What is 'soil erosion'?", options: ["Formation of new soil.", "The process by which soil and rock are removed from the Earth's surface by exogenous processes such as wind or water flow, and then transported and deposited in other locations.", "Soil enrichment.", "Fertilization of soil."], correctOptionIndex: 1, explanation: "Soil erosion reduces agricultural productivity (Page 585)." },
                    { question: "Which farming practice helps prevent soil erosion?", options: ["Monoculture", "Overgrazing", "Terrace farming", "Clear-cutting"], correctOptionIndex: 2, explanation: "Terrace farming reduces the flow of water and prevents soil runoff on slopes (Page 586)." },
                    { question: "What are 'minerals'?", options: ["Plants.", "Naturally occurring inorganic solids with a definite chemical composition and a crystal structure.", "Man-made compounds.", "Liquids found underground."], correctOptionIndex: 1, explanation: "Minerals are essential for industrial and technological development (Page 587)." },
                    { question: "Which of the following is a 'metallic mineral'?", options: ["Limestone", "Gypsum", "Iron ore", "Salt"], correctOptionIndex: 2, explanation: "Metallic minerals are sources of metals like iron, copper, and aluminum (Page 588)." },
                    { question: "Which of the following is a 'non-metallic mineral'?", options: ["Gold", "Silver", "Coal", "Mica"], correctOptionIndex: 3, explanation: "Non-metallic minerals include limestone, gypsum, and mica (Page 589)." },
                    { question: "What is the primary use of 'petroleum'?", options: ["Building materials.", "Fuel for vehicles and heating, and a raw material for plastics.", "Fertilizers.", "Drinking water."], correctOptionIndex: 1, explanation: "Petroleum is a vital energy source and chemical feedstock (Page 590)." },
                    { question: "What is 'natural gas' mainly used for?", options: ["Construction.", "Electricity generation, heating, and as a vehicle fuel.", "Water purification.", "Food preservation."], correctOptionIndex: 1, explanation: "Natural gas is a cleaner-burning fossil fuel than coal or oil (Page 590)." },
                    { question: "What is 'biomass energy'?", options: ["Energy from nuclear reactions.", "Energy derived from organic matter, such as plants and animal waste.", "Energy from wind.", "Energy from tides."], correctOptionIndex: 1, explanation: "Biomass is a renewable energy source (Page 580)." },
                    { question: "What is 'geothermal energy'?", options: ["Energy from the sun.", "Energy derived from the heat within the Earth's core.", "Energy from water.", "Energy from wind."], correctOptionIndex: 1, explanation: "Geothermal energy is a clean and sustainable energy source (Page 580)." }
                ];
                originalQuizQuestions.push(...socialStudiesMCQs);

                // English (25 MCQs from Pages 855-870 - Vocabulary and Sentence Transformation)
                const englishMCQs = [
                    { question: "Choose the antonym of 'ancient'.", options: ["Old", "New", "Historical", "Antique"], correctOptionIndex: 1, explanation: "Antonyms are words with opposite meanings (Page 855)." },
                    { question: "Choose the synonym of 'happy'.", options: ["Sad", "Joyful", "Angry", "Tired"], correctOptionIndex: 1, explanation: "Synonyms are words with similar meanings (Page 856)." },
                    { question: "Which word means 'brave'?", options: ["Cowardly", "Fearful", "Courageous", "Timid"], correctOptionIndex: 2, explanation: "Courageous is a synonym for brave (Page 857)." },
                    { question: "Which word means 'tiny'?", options: ["Huge", "Large", "Small", "Giant"], correctOptionIndex: 2, explanation: "Small is a synonym for tiny (Page 858)." },
                    { question: "Choose the antonym of 'fast'.", options: ["Quick", "Rapid", "Slow", "Swift"], correctOptionIndex: 2, explanation: "Slow is the opposite of fast (Page 859)." },
                    { question: "Transform into an interrogative sentence: 'He is playing cricket.'", options: ["He is not playing cricket.", "Is he playing cricket?", "He was playing cricket.", "Cricket is being played by him."], correctOptionIndex: 1, explanation: "Interrogative sentences ask questions (Page 860)." },
                    { question: "Transform into a negative sentence: 'She writes a letter.'", options: ["Does she write a letter?", "She does not write a letter.", "A letter is written by her.", "She wrote a letter."], correctOptionIndex: 1, explanation: "Negative sentences use 'not' or similar negating words (Page 861)." },
                    { question: "Transform into an imperative sentence: 'You should close the door.'", options: ["Did you close the door?", "Close the door.", "The door is closed by you.", "You closed the door."], correctOptionIndex: 1, explanation: "Imperative sentences give commands (Page 862)." },
                    { question: "Transform into an exclamatory sentence: 'It is a very beautiful flower.'", options: ["Is it a beautiful flower?", "It is not a beautiful flower.", "What a beautiful flower it is!", "It was a beautiful flower."], correctOptionIndex: 2, explanation: "Exclamatory sentences express strong emotion (Page 863)." },
                    { question: "Change the voice: 'The dog chases the cat.'", options: ["The cat is chased by the dog.", "The cat chases the dog.", "The dog is chased.", "The dog was chased by the cat."], correctOptionIndex: 0, explanation: "In passive voice, the object of the active voice becomes the subject (Page 864)." },
                    { question: "Change the voice: 'She bought a car.'", options: ["A car was bought by her.", "A car is bought by her.", "She sells a car.", "A car will be bought by her."], correctOptionIndex: 0, explanation: "Past simple active becomes past simple passive (Page 865)." },
                    { question: "Change the voice: 'They are building a house.'", options: ["A house is built by them.", "A house is being built by them.", "A house was built by them.", "They built a house."], correctOptionIndex: 1, explanation: "Present continuous active becomes present continuous passive (Page 866)." },
                    { question: "Change the voice: 'He will write a book.'", options: ["A book is written by him.", "A book will be written by him.", "A book was written by him.", "He wrote a book."], correctOptionIndex: 1, explanation: "Future simple active becomes future simple passive (Page 867)." },
                    { question: "Change the voice: 'The students solved the problems.'", options: ["The problems are solved by the students.", "The problems were solved by the students.", "The problems are being solved by the students.", "The students are solving the problems."], correctOptionIndex: 1, explanation: "Past simple active becomes past simple passive (Page 868)." },
                    { question: "Choose the correct spelling:", options: ["Seperate", "Separate", "Seperate", "Sepparate"], correctOptionIndex: 1, explanation: "Correct spelling is 'separate' (Page 869)." },
                    { question: "Choose the correct spelling:", options: ["Accomodate", "Acomodate", "Accommodate", "Acommodatte"], correctOptionIndex: 2, explanation: "Correct spelling is 'accommodate' (Page 869)." },
                    { question: "Choose the correct spelling:", options: ["Definately", "Definitely", "Definetely", "Definitly"], correctOptionIndex: 1, explanation: "Correct spelling is 'definitely' (Page 869)." },
                    { question: "Choose the correct spelling:", options: ["recieve", "receive", "receieve", "recive"], correctOptionIndex: 1, explanation: "Correct spelling is 'receive' (Page 869)." },
                    { question: "Choose the correct spelling:", options: ["occassion", "occasion", "ocassion", "occassionn"], correctOptionIndex: 1, explanation: "Correct spelling is 'occasion' (Page 869)." },
                    { question: "Choose the correct synonym for 'terminate'.", options: ["Begin", "End", "Start", "Continue"], correctOptionIndex: 1, explanation: "Terminate means to bring to an end (Page 856)." },
                    { question: "Choose the correct antonym for 'expand'.", options: ["Enlarge", "Grow", "Shrink", "Spread"], correctOptionIndex: 2, explanation: "Expand means to make larger, shrink means to make smaller (Page 859)." },
                    { question: "Identify the part of speech of 'quickly' in the sentence: 'He ran quickly.'", options: ["Noun", "Verb", "Adjective", "Adverb"], correctOptionIndex: 3, explanation: "Quickly modifies the verb 'ran', indicating how he ran (Page 850)." },
                    { question: "Identify the part of speech of 'beautiful' in the sentence: 'She has a beautiful dress.'", options: ["Noun", "Verb", "Adjective", "Adverb"], correctOptionIndex: 2, explanation: "Beautiful describes the noun 'dress' (Page 850)." },
                    { question: "Identify the part of speech of 'run' in the sentence: 'They run every morning.'", options: ["Noun", "Verb", "Adjective", "Adverb"], correctOptionIndex: 1, explanation: "Run is the action performed by the subject 'they' (Page 850)." },
                    { question: "Identify the part of speech of 'table' in the sentence: 'The book is on the table.'", options: ["Noun", "Verb", "Adjective", "Adverb"], correctOptionIndex: 0, explanation: "Table is a naming word for a thing (Page 850)." }
                ];
                originalQuizQuestions.push(...englishMCQs);

                // Mathematics (25 MCQs from Pages 1003-1020 - Basic Geometry and Algebra)
                const mathematicsMCQs = [
                    { question: "What is the sum of angles in a triangle?", options: ["90°", "180°", "270°", "360°"], correctOptionIndex: 1, explanation: "The sum of interior angles in any triangle is always 180 degrees (Page 1003)." },
                    { question: "What is the perimeter of a square with side length 5 cm?", options: ["10 cm", "20 cm", "25 cm", "30 cm"], correctOptionIndex: 1, explanation: "Perimeter of a square = $4 \\times side = 4 \\times 5 = 20$ cm (Page 1004)." },
                    { question: "What is the area of a rectangle with length 8 cm and width 4 cm?", options: ["12 cm²", "16 cm²", "32 cm²", "48 cm²"], correctOptionIndex: 2, explanation: "Area of a rectangle = $length \\times width = 8 \\times 4 = 32$ cm² (Page 1005)." },
                    { question: "What is the formula for the circumference of a circle?", options: ["$\\pi r^2$", "$2 \\pi r$", "$\\pi d$", "$r/2$"], correctOptionIndex: 1, explanation: "Circumference is the distance around the circle, also expressible as $\\pi d$ where d is diameter (Page 1006)." },
                    { question: "What is the area of a circle with radius 7 cm? (Use $\\pi = 22/7$)", options: ["44 cm²", "77 cm²", "154 cm²", "308 cm²"], correctOptionIndex: 2, explanation: "Area of a circle = $\\pi r^2 = (22/7) \\times 7^2 = (22/7) \\times 49 = 22 \\times 7 = 154$ cm² (Page 1007)." },
                    { question: "What is a 'right angle triangle'?", options: ["A triangle with all angles equal.", "A triangle with one angle greater than 90°.", "A triangle with one angle exactly 90°.", "A triangle with two equal sides."], correctOptionIndex: 2, explanation: "The side opposite the right angle is called the hypotenuse (Page 1008)." },
                    { question: "What is the value of $x$ in $5x - 10 = 20$?", options: ["4", "5", "6", "7"], correctOptionIndex: 1, explanation: "Add 10 to both sides: $5x = 30$. Divide by 5: $x = 6$ (Page 1009)." },
                    { question: "Solve the equation: $x/3 + 2 = 5$", options: ["3", "6", "9", "12"], correctOptionIndex: 2, explanation: "Subtract 2 from both sides: $x/3 = 3$. Multiply by 3: $x = 9$ (Page 1010)." },
                    { question: "What is the cube root of 27?", options: ["2", "3", "4", "5"], correctOptionIndex: 1, explanation: "The cube root of 27 is 3, because $3 \\times 3 \\times 3 = 27$ (Page 1011)." },
                    { question: "What is the square of 11?", options: ["11", "22", "121", "131"], correctOptionIndex: 2, explanation: "$11^2 = 11 \\times 11 = 121$ (Page 1012)." },
                    { question: "What is 'algebra'?", options: ["The study of shapes.", "A branch of mathematics that deals with symbols and the rules for manipulating these symbols.", "The study of numbers.", "The study of statistics."], correctOptionIndex: 1, explanation: "Algebra uses variables and operations to solve equations (Page 1013)." },
                    { question: "What is an 'expression' in algebra?", options: ["An equation with an equals sign.", "A combination of numbers, variables, and operation symbols (like +, -, ×, ÷).", "A single number.", "A problem with no solution."], correctOptionIndex: 1, explanation: "Expressions do not contain an equals sign (Page 1014)." },
                    { question: "What is a 'term' in an algebraic expression?", options: ["A mathematical statement with an equals sign.", "A single number, a single variable, or numbers and variables multiplied together.", "Only a variable.", "Only a number."], correctOptionIndex: 1, explanation: "Terms are separated by addition or subtraction signs (Page 1015)." },
                    { question: "What is a 'coefficient'?", options: ["A variable in an expression.", "The number multiplied by a variable in an algebraic term.", "A constant term.", "An exponent."], correctOptionIndex: 1, explanation: "In $3x$, 3 is the coefficient (Page 1016)." },
                    { question: "What is a 'constant' in an algebraic expression?", options: ["A variable whose value can change.", "A term that has a fixed numerical value and does not contain any variables.", "A number multiplied by a variable.", "An exponent."], correctOptionIndex: 1, explanation: "Constants are fixed values, e.g., 5 in $2x + 5$ (Page 1017)." },
                    { question: "What is the definition of a 'variable' in algebra?", options: ["A fixed numerical value.", "A symbol, usually a letter, that represents a quantity that can change or take on different values.", "A coefficient.", "An operation symbol."], correctOptionIndex: 1, explanation: "Variables allow generalization in mathematics (Page 1018)." },
                    { question: "What are 'like terms'?", options: ["Terms with different variables.", "Terms that have the same variables raised to the same power.", "Terms that have different coefficients.", "Terms with only numbers."], correctOptionIndex: 1, explanation: "Only like terms can be combined (Page 1019)." },
                    { question: "Simplify: $4x + 2y - x + 5y$", options: ["$3x + 7y$", "$5x + 7y$", "$3x + 3y$", "$5x + 3y$"], correctOptionIndex: 0, explanation: "Combine x terms ($4x - x = 3x$) and y terms ($2y + 5y = 7y$) (Page 1019)." },
                    { question: "Solve for $x$: $x/2 - 1 = 4$", options: ["8", "10", "12", "14"], correctOptionIndex: 1, explanation: "Add 1 to both sides: $x/2 = 5$. Multiply by 2: $x = 10$ (Page 1009)." },
                    { question: "If the area of a square is 36 cm², what is its side length?", options: ["4 cm", "6 cm", "9 cm", "12 cm"], correctOptionIndex: 1, explanation: "Side length = $\\sqrt{Area} = \\sqrt{36} = 6$ cm (Page 1004)." },
                    { question: "What is the perimeter of a regular octagon with side length 7 cm?", options: ["49 cm", "56 cm", "63 cm", "70 cm"], correctOptionIndex: 1, explanation: "An octagon has 8 sides. Perimeter = $8 \\times side = 8 \\times 7 = 56$ cm (Page 1004)." },
                    { question: "What is the volume of a cube with side length 3 cm?", options: ["9 cm³", "18 cm³", "27 cm³", "36 cm³"], correctOptionIndex: 2, explanation: "Volume of a cube = $side^3 = 3^3 = 27$ cm³ (Page 1005)." },
                    { question: "Which symbol represents 'pi' in mathematics?", options: ["$\\alpha$", "$\\beta$", "$\\pi$", "$\\Sigma$"], correctOptionIndex: 2, explanation: "Pi ($\\pi$) is a mathematical constant used in calculations involving circles (Page 1006)." },
                    { question: "What is an 'integer'?", options: ["A fraction.", "A whole number (positive, negative, or zero) that is not a fraction or a decimal.", "A decimal number.", "A square root."], correctOptionIndex: 1, explanation: "Integers include numbers like -3, 0, 5 (Page 1003)." },
                    { question: "What is the order of operations in mathematics, often remembered by PEMDAS/BODMAS?", options: ["Addition, Subtraction, Multiplication, Division", "Parentheses/Brackets, Exponents/Orders, Multiplication, Division, Addition, Subtraction", "Multiplication, Division, Addition, Subtraction, Parentheses, Exponents", "Exponents, Parentheses, Addition, Subtraction, Multiplication, Division"], correctOptionIndex: 1, explanation: "PEMDAS/BODMAS ensures consistent results in complex calculations (Page 1013)." }
                ];
                originalQuizQuestions.push(...mathematicsMCQs);

                // History (15 MCQs from Pages 750-790)
                const historyMCQs = [
                    { question: "What was the primary goal of the 'Khilafat Movement' in India?", options: ["To establish a new empire.", "To support the Ottoman Caliphate and protect Muslim holy places.", "To fight against the British.", "To promote education."], correctOptionIndex: 1, explanation: "The Khilafat Movement was a pan-Islamic political protest campaign (Page 750)." },
                    { question: "Who was the leader of the Khilafat Movement in India?", options: ["Mahatma Gandhi", "Muhammad Ali Jinnah", "Maulana Muhammad Ali Jauhar and Shaukat Ali", "Allama Iqbal"], correctOptionIndex: 2, explanation: "The Ali brothers played a pivotal role in the movement (Page 751)." },
                    { question: "When was the 'Non-Cooperation Movement' launched by Mahatma Gandhi?", options: ["1919", "1920", "1922", "1930"], correctOptionIndex: 1, explanation: "The Non-Cooperation Movement aimed to resist British rule through non-violent means (Page 752)." },
                    { question: "What was the 'Jallianwala Bagh Massacre'?", options: ["A battle during the Sepoy Mutiny.", "A peaceful protest where British troops fired on unarmed civilians.", "A trade agreement.", "A religious festival."], correctOptionIndex: 1, explanation: "This tragic event in 1919 deeply impacted the Indian independence movement (Page 753)." },
                    { question: "When did the 'Simon Commission' visit India?", options: ["1925", "1927", "1928", "1930"], correctOptionIndex: 2, explanation: "The Simon Commission was boycotted by Indian leaders because it had no Indian members (Page 754)." },
                    { question: "What was the 'Lahore Resolution' (Pakistan Resolution)?", options: ["A demand for unified India.", "A resolution passed in 1940 by the All-India Muslim League demanding separate electorates for Muslims.", "A demand for a separate Muslim state.", "A call for Hindu-Muslim unity."], correctOptionIndex: 2, explanation: "The Lahore Resolution officially called for the creation of independent Muslim states in Northwest and Eastern India (Page 755)." },
                    { question: "Who presided over the Lahore Resolution session in 1940?", options: ["Allama Iqbal", "Mahatma Gandhi", "Muhammad Ali Jinnah", "Jawaharlal Nehru"], correctOptionIndex: 2, explanation: "Muhammad Ali Jinnah delivered a historic speech at the session (Page 756)." },
                    { question: "What was the 'Quit India Movement'?", options: ["A movement for British to stay in India.", "A civil disobedience movement launched by Mahatma Gandhi in 1942 demanding an end to British rule in India.", "A movement to join the British army.", "A movement to support the British war efforts."], correctOptionIndex: 1, explanation: "The movement led to widespread arrests and protests (Page 757)." },
                    { question: "When was the 'Cabinet Mission Plan' introduced?", options: ["1942", "1945", "1946", "1947"], correctOptionIndex: 2, explanation: "The Cabinet Mission Plan aimed to find a solution for India's independence and constitutional framework (Page 758)." },
                    { question: "What was the main proposal of the 'Cabinet Mission Plan' regarding the partition of India?", options: ["Immediate partition into two states.", "A united India with a weak center and strong provinces.", "A confederation of Indian states.", "A prolonged period of British rule."], correctOptionIndex: 1, explanation: "The plan initially proposed a federal structure for a united India (Page 759)." },
                    { question: "Who was the first Governor-General of Pakistan?", options: ["Liaquat Ali Khan", "Muhammad Ali Jinnah", "Lord Mountbatten", "Khawaja Nazimuddin"], correctOptionIndex: 1, explanation: "Muhammad Ali Jinnah played a crucial role in the creation of Pakistan (Page 760)." },
                    { question: "Who was the first Prime Minister of Pakistan?", options: ["Muhammad Ali Jinnah", "Liaquat Ali Khan", "Khawaja Nazimuddin", "Ghulam Muhammad"], correctOptionIndex: 1, explanation: "Liaquat Ali Khan led Pakistan as its first Prime Minister (Page 761)." },
                    { question: "When was the first Constitution of Pakistan adopted?", options: ["1947", "1956", "1962", "1973"], correctOptionIndex: 1, explanation: "The 1956 Constitution established Pakistan as an Islamic Republic (Page 762)." },
                    { question: "What was the 'Basic Democracies System' introduced by Ayub Khan?", options: ["A socialist economic system.", "A four-tiered system of local government aimed at decentralizing power.", "A parliamentary system.", "A military dictatorship."], correctOptionIndex: 1, explanation: "The Basic Democracies System was introduced in 1959 (Page 763)." },
                    { question: "When was the 1962 Constitution of Pakistan promulgated?", options: ["1956", "1962", "1965", "1971"], correctOptionIndex: 1, explanation: "The 1962 Constitution introduced a presidential form of government (Page 764)." }
                ];
                originalQuizQuestions.push(...historyMCQs);
                
                // Randomly select one special question from the entire set on initial load
                // and store its ORIGINAL index. This ensures the same question is 'special'
                // across quiz restarts unless the data is explicitly reloaded.
                specialQuestionOriginalIndex = Math.floor(Math.random() * originalQuizQuestions.length);
            }

            // Create a fresh copy of questions for the current quiz attempt
            quizQuestions = JSON.parse(JSON.stringify(originalQuizQuestions));

            // Mark the special question in the current quizQuestions array
            quizQuestions[specialQuestionOriginalIndex].special = true;

            // Shuffle the entire quiz question order
            shuffleArray(quizQuestions);

            // After shuffling, update the 'special' flag if the original special question
            // is still in the quiz and ensure its .special property is true.
            // This loop is mostly for safety and to re-verify the flag after shuffle.
            quizQuestions.forEach((q, index) => {
                if (q.special && index !== specialQuestionOriginalIndex) {
                    // If a question was marked special but its index changed due to shuffle,
                    // we need to make sure the one originally picked remains special.
                    // This logic ensures only one question is truly special for the day.
                    q.special = false; // Unmark if it's not the original special question
                }
            });
            // Re-mark the correct special question in the shuffled array
            // Find the special question in the newly shuffled array
            const currentSpecialQuestion = quizQuestions.find(q => q.special);
            if (currentSpecialQuestion) {
                 // The special question is already marked `true` from the shallow copy.
                 // This ensures the correct, originally-picked special question keeps its flag.
            } else {
                // If by some very rare chance (e.g., if a special question was not initially marked, which it is),
                // or if the `find` fails, pick one again. This is a fallback.
                const newSpecialIndex = Math.floor(Math.random() * quizQuestions.length);
                quizQuestions[newSpecialIndex].special = true;
                specialQuestionOriginalIndex = originalQuizQuestions.findIndex(q => JSON.stringify(q) === JSON.stringify(quizQuestions[newSpecialIndex]));
            }
        }

        // Load MathJax for rendering LaTeX
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
        script.async = true;
        document.head.appendChild(script);

        // Initialize the quiz when the script loads
        initializeQuiz();
        // Explicitly show the login page after initialization to prevent any display issues
        showPage('loginPage');
    </script>
</body>
</html>
